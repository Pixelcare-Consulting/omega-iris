datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

model User {
    id            String    @id @default(cuid())
    code          Int       @unique @default(autoincrement())
    username      String    @unique
    fname         String
    lname         String
    email         String    @unique
    emailVerified DateTime?
    password      String    @default("")
    roleCode      Int
    isOnline      Boolean   @default(false)
    isActive      Boolean   @default(true)
    location      String?
    lastIpAddress String?
    lastSignin    DateTime?
    customerCode  String?
    supplierCode  String?

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    accounts Account[]
    profile  Profile?
    role     Role      @relation(fields: [roleCode], references: [code])

    projectIndividualPics      ProjectIndividualPic[]      @relation(name: "User-ProjectIndividualPic")
    projectIndividualCustomers ProjectIndividualCustomer[] @relation(name: "User-ProjectIndividualCustomer")
    inventories                Inventory[]
}

model Role {
    id          String  @id @default(cuid())
    code        Int     @unique @default(autoincrement())
    name        String
    key         String  @unique
    description String? @default("")

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    users User[]
}

model Profile {
    id       String @id @default(cuid())
    code     Int    @unique @default(autoincrement())
    userCode Int    @unique

    details Json?

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    user User @relation(fields: [userCode], references: [code], onUpdate: Cascade, onDelete: Cascade)
}

model Account {
    userId            String
    type              String
    provider          String
    providerAccountId String
    refresh_token     String?
    access_token      String?
    expires_at        Int?
    token_type        String?
    scope             String?
    id_token          String?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    user User @relation(fields: [userId], references: [id], onUpdate: Cascade, onDelete: Cascade)

    @@id([provider, providerAccountId])
}

model ProjectGroup {
    id          String  @id @default(cuid())
    code        Int     @unique @default(autoincrement())
    name        String
    description String?
    isActive    Boolean @default(true)

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    projectIndividuals ProjectIndividual[] @relation()
}

model ProjectIndividual {
    id          String  @id @default(cuid())
    code        Int     @unique @default(autoincrement())
    name        String
    groupCode   Int
    description String?
    isActive    Boolean @default(true)

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    projectIndividualPics      ProjectIndividualPic[]      @relation(name: "ProjectIndividual-ProjectIndividualPic")
    projectIndividualCustomers ProjectIndividualCustomer[] @relation(name: "ProjectIndividual-ProjectIndividualCustomer")
    projectGroup               ProjectGroup                @relation(fields: [groupCode], references: [code], onUpdate: Cascade, onDelete: Cascade)
    inventories                Inventory[]
}

model ProjectIndividualCustomer {
    id                    String @id @default(cuid())
    code                  Int    @unique @default(autoincrement())
    projectIndividualCode Int
    userCode              Int

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    projectIndividual ProjectIndividual @relation(name: "ProjectIndividual-ProjectIndividualCustomer", fields: [projectIndividualCode], references: [code], onUpdate: Cascade, onDelete: Cascade)
    user              User              @relation(name: "User-ProjectIndividualCustomer", fields: [userCode], references: [code], onUpdate: Cascade, onDelete: Cascade)

    @@unique([projectIndividualCode, userCode])
    @@index([projectIndividualCode])
    @@index([userCode])
}

model ProjectIndividualPic {
    id                    String @id @default(cuid())
    code                  Int    @unique @default(autoincrement())
    projectIndividualCode Int
    userCode              Int

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    projectIndividual ProjectIndividual @relation(name: "ProjectIndividual-ProjectIndividualPic", fields: [projectIndividualCode], references: [code], onUpdate: Cascade, onDelete: Cascade)
    user              User              @relation(name: "User-ProjectIndividualPic", fields: [userCode], references: [code], onUpdate: Cascade, onDelete: Cascade)

    @@unique([projectIndividualCode, userCode])
    @@index([projectIndividualCode])
    @@index([userCode])
}

model Inventory {
    id                     String    @id @default(cuid())
    code                   Int       @unique @default(autoincrement())
    userCode               Int //* user code of a user with customer role
    projectIndividualCode  Int
    thumbnail              String?
    partNumber             String    @unique
    manufacturer           String
    manufacturerPartNumber String
    description            String
    dateCode               String?
    lotCode                String?
    siteLocation           String?
    subLocation1           String?
    subLocation2           String?
    subLocation3           String?
    subLocation4           String?
    packagingType          String?
    spq                    String?
    cost                   Decimal
    countryOfOrigin        String?
    note                   String?
    palletSize             String? //* STANDARD, OVERSIZE, CRATES 
    palletNo               String?
    isActive               Boolean   @default(true)
    dateReceived           DateTime?
    inProcess              Int?

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    projectIndividual    ProjectIndividual    @relation(fields: [projectIndividualCode], references: [code], onUpdate: Cascade, onDelete: Cascade)
    user                 User                 @relation(fields: [userCode], references: [code], onUpdate: Cascade, onDelete: Cascade)
    warehouseInventories WarehouseInventory[]

    @@index([userCode])
    @@index([projectIndividualCode])
}

model Warehouse {
    id                   String  @id @default(cuid())
    code                 Int     @unique @default(autoincrement())
    name                 String
    description          String?
    isActive             Boolean @default(true)
    isDefault            Boolean @default(false)
    isNettable           Boolean @default(false)
    isEnableBinLocations Boolean @default(false)

    address1          String?
    address2          String?
    address3          String?
    streetPoBox       String?
    streetNo          String?
    block             String?
    buildingFloorRoom String?
    zipCode           String?
    city              String?
    county            String?
    countryRegion     String?
    state             String?
    federalTaxId      String?
    gln               String?
    taxOffice         String?

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    inventories WarehouseInventory[]
}

model WarehouseInventory {
    id            String  @id @default(cuid())
    code          Int     @unique @default(autoincrement())
    warehouseCode Int
    inventoryCode Int
    isLocked      Boolean @default(false)
    inStock       Int     @default(0)
    committed     Int     @default(0)
    ordered       Int     @default(0)
    available     Int     @default(0)

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    warehouse Warehouse @relation(fields: [warehouseCode], references: [code], onUpdate: Cascade, onDelete: Cascade)
    inventory Inventory @relation(fields: [inventoryCode], references: [code], onUpdate: Cascade, onDelete: Cascade)

    @@unique([warehouseCode, inventoryCode])
    @@index([warehouseCode])
    @@index([inventoryCode])
}

model Settings {
    id       String  @id @default(cuid())
    roleCode Int?
    code     Int     @unique @default(autoincrement())
    data     Json //* JSON containing all settings
    isGlobal Boolean @default(false)

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?
}

//* add model system logs
