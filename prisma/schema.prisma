datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

model User {
    id            String    @id @default(cuid())
    code          Int       @unique @default(autoincrement())
    username      String    @unique
    fname         String
    lname         String
    email         String    @unique
    emailVerified DateTime?
    password      String    @default("")
    roleCode      Int
    isOnline      Boolean   @default(false)
    isActive      Boolean   @default(true)
    location      String?
    lastIpAddress String?
    lastSignin    DateTime?
    customerCode  String?
    supplierCode  String?

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    accounts Account[]
    profile  Profile?
    role     Role      @relation(fields: [roleCode], references: [code])

    projectIndividualPics      ProjectIndividualPic[]      @relation(name: "User-ProjectIndividualPic")
    projectIndividualCustomers ProjectIndividualCustomer[] @relation(name: "User-ProjectIndividualCustomer")
    workOrders                 WorkOrder[]
    projectItemDateReceivedBy  ProjectItem[]               @relation()
}

model Role {
    id          String  @id @default(cuid())
    code        Int     @unique @default(autoincrement())
    name        String
    key         String  @unique
    description String? @default("")

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    users User[]
}

model Profile {
    id       String @id @default(cuid())
    code     Int    @unique @default(autoincrement())
    userCode Int    @unique

    details Json?

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    user User @relation(fields: [userCode], references: [code], onUpdate: Cascade, onDelete: Cascade)
}

model Account {
    userId            String
    type              String
    provider          String
    providerAccountId String
    refresh_token     String?
    access_token      String?
    expires_at        Int?
    token_type        String?
    scope             String?
    id_token          String?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    user User @relation(fields: [userId], references: [id], onUpdate: Cascade, onDelete: Cascade)

    @@id([provider, providerAccountId])
}

model Item {
    id                     String  @id @default(cuid())
    code                   Int     @unique @default(autoincrement())
    manufacturerPartNumber String  @unique
    manufacturer           String?
    description            String?
    thumbnail              String?
    notes                  String?
    isActive               Boolean @default(true)

    //* sap fields
    ItemCode   String?
    ItemName   String?
    FirmCode   Int?
    FirmName   String?
    ItmsGrpCod Int?
    ItmsGrpNam String?
    Price      Decimal?

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    projectItems           ProjectItem[]
    itemWarehouseInventory ItemWarehouseInventory[]
}

model ItemWarehouseInventory {
    id            String  @id @default(cuid())
    code          Int     @unique @default(autoincrement())
    warehouseCode Int
    itemCode      Int
    isLocked      Boolean @default(false)
    inStock       Int     @default(0)
    committed     Int     @default(0)
    ordered       Int     @default(0)
    available     Int     @default(0)

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    warehouse Warehouse @relation(fields: [warehouseCode], references: [code], onUpdate: Cascade, onDelete: Cascade)
    item      Item      @relation(fields: [itemCode], references: [code], onUpdate: Cascade, onDelete: Cascade)

    @@unique([warehouseCode, itemCode])
    @@index([warehouseCode])
    @@index([itemCode])
}

model Warehouse {
    id                   String  @id @default(cuid())
    code                 Int     @unique @default(autoincrement())
    name                 String
    description          String?
    isActive             Boolean @default(true)
    isDefault            Boolean @default(false)
    isNettable           Boolean @default(false)
    isEnableBinLocations Boolean @default(false)

    address1          String?
    address2          String?
    address3          String?
    streetPoBox       String?
    streetNo          String?
    block             String?
    buildingFloorRoom String?
    zipCode           String?
    city              String?
    county            String?
    countryRegion     String?
    state             String?
    federalTaxId      String?
    gln               String?
    taxOffice         String?

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    itemInventories ItemWarehouseInventory[]
    projectItems    ProjectItem[]
}

model ProjectGroup {
    id          String  @id @default(cuid())
    code        Int     @unique @default(autoincrement())
    name        String
    description String?
    isActive    Boolean @default(true)

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    projectIndividuals ProjectIndividual[] @relation()
}

model ProjectIndividual {
    id          String  @id @default(cuid())
    code        Int     @unique @default(autoincrement())
    name        String
    groupCode   Int?
    description String?
    isActive    Boolean @default(true)

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    projectGroup ProjectGroup? @relation(fields: [groupCode], references: [code], onUpdate: Cascade, onDelete: Cascade)

    projectIndividualPics      ProjectIndividualPic[]      @relation(name: "ProjectIndividual-ProjectIndividualPic")
    projectIndividualCustomers ProjectIndividualCustomer[] @relation(name: "ProjectIndividual-ProjectIndividualCustomer")
    items                      ProjectItem[]
    workOrders                 WorkOrder[]
}

//* NOTE: Item must be synced already in SAP before it can be selected for project item 
model ProjectItem {
    id                    String @id @default(cuid())
    code                  Int    @unique @default(autoincrement())
    itemCode              Int
    projectIndividualCode Int

    warehouseCode    Int?
    partNumber       String?
    dateCode         String?
    countryOfOrigin  String?
    lotCode          String?
    palletNo         String?
    packagingType    String?
    spq              String?
    dateReceived     DateTime?
    dateReceivedBy   Int?
    cost             Decimal?  @default(0)
    availableToOrder Decimal?  @default(0)
    inProcess        Decimal?  @default(0)
    totalStock       Decimal?  @default(0)
    siteLocation     String?
    subLocation2     String?
    subLocation3     String?
    notes            String?

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    item               Item              @relation(fields: [itemCode], references: [code], onUpdate: Cascade, onDelete: Cascade)
    projectIndividual  ProjectIndividual @relation(fields: [projectIndividualCode], references: [code], onUpdate: Cascade, onDelete: Cascade)
    warehouse          Warehouse?        @relation(fields: [warehouseCode], references: [code], onUpdate: Cascade, onDelete: Cascade)
    dateReceivedByUser User?             @relation(fields: [dateReceivedBy], references: [code], onUpdate: Cascade, onDelete: Cascade)

    workOrderItems WorkOrderItem[]

    @@index([projectIndividualCode])
    @@index([itemCode])
}

model ProjectIndividualCustomer {
    id                    String @id @default(cuid())
    code                  Int    @unique @default(autoincrement())
    projectIndividualCode Int
    userCode              Int

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    projectIndividual ProjectIndividual @relation(name: "ProjectIndividual-ProjectIndividualCustomer", fields: [projectIndividualCode], references: [code], onUpdate: Cascade, onDelete: Cascade)
    user              User              @relation(name: "User-ProjectIndividualCustomer", fields: [userCode], references: [code], onUpdate: Cascade, onDelete: Cascade)

    @@unique([projectIndividualCode, userCode])
    @@index([projectIndividualCode])
    @@index([userCode])
}

model ProjectIndividualPic {
    id                    String @id @default(cuid())
    code                  Int    @unique @default(autoincrement())
    projectIndividualCode Int
    userCode              Int

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    projectIndividual ProjectIndividual @relation(name: "ProjectIndividual-ProjectIndividualPic", fields: [projectIndividualCode], references: [code], onUpdate: Cascade, onDelete: Cascade)
    user              User              @relation(name: "User-ProjectIndividualPic", fields: [userCode], references: [code], onUpdate: Cascade, onDelete: Cascade)

    @@unique([projectIndividualCode, userCode])
    @@index([projectIndividualCode])
    @@index([userCode])
}

model WorkOrder {
    id                    String  @id @default(cuid())
    code                  Int     @unique @default(autoincrement())
    projectIndividualCode Int
    userCode              Int
    status                String
    isInternal            Boolean @default(false)
    billingAddrCode       String?
    deliveryAddrCode      String?
    comments              String?
    salesOrderCode        Int?
    purchaseOrderCode     Int?

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?

    projectIndividual ProjectIndividual @relation(fields: [projectIndividualCode], references: [code], onUpdate: Cascade, onDelete: Cascade)
    user              User              @relation(fields: [userCode], references: [code], onUpdate: Cascade, onDelete: Cascade)

    workOrderItems         WorkOrderItem[]
    workOrderStatusUpdates WorkOrderStatusUpdate[]

    @@index([projectIndividualCode])
    @@index([userCode])
}

model WorkOrderStatusUpdate {
    id            String  @id @default(cuid())
    code          Int     @unique @default(autoincrement())
    workOrderCode Int
    prevStatus    String
    currentStatus String
    comments      String?

    createdAt DateTime @default(now())
    createdBy String?

    workOrder WorkOrder @relation(fields: [workOrderCode], references: [code], onUpdate: Cascade, onDelete: Cascade)

    @@index([workOrderCode])
}

model WorkOrderItem {
    workOrderCode   Int
    projectItemCode Int
    qty             Decimal? @default(0)

    workOrder   WorkOrder   @relation(fields: [workOrderCode], references: [code], onUpdate: Cascade, onDelete: Cascade)
    projectItem ProjectItem @relation(fields: [projectItemCode], references: [code], onUpdate: Cascade, onDelete: Cascade)

    @@unique([workOrderCode, projectItemCode])
    @@index([workOrderCode])
    @@index([projectItemCode])
}

model Settings {
    id       String  @id @default(cuid())
    roleCode Int?
    code     Int     @unique @default(autoincrement())
    data     Json //* JSON containing all settings
    isGlobal Boolean @default(false)

    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    deletedAt DateTime?
    createdBy String?
    updatedBy String?
    deletedBy String?
}

//* add model system logs
